class t{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e,this.state=JSON.parse(JSON.stringify(e)),this.status=t.STATUS_IDLE,this.score=0}static STATUS_IDLE="idle";static STATUS_PLAYING="playing";static STATUS_WIN="win";static STATUS_LOSE="lose";moveLeft(){let t=this.getState();for(let e=0;e<4;e++){let s=[];for(let r=0;r<4;r++){let a=t[e][r];a&&s.push(a)}for(let t=0;t<s.length;t++){let e=s[t],r=t+1<s.length?s[t+1]:null;if(!r)break;if(e===r){let r=this.getScore()+2*e;this.score=r,s.splice(t,2,2*e)}}if(4!==s.length){for(;s.length<4;)s.push(0);for(let r=0;r<4;r++)t[e][r]=s[r]}}}moveRight(){this.reverseStateByRows(),this.moveLeft(),this.reverseStateByRows()}moveUp(){this.rotateStateBackwardBy90Deg(),this.moveLeft(),this.rotateStateForwardBy90Deg()}moveDown(){this.rotateStateForwardBy90Deg(),this.moveLeft(),this.rotateStateBackwardBy90Deg()}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.state=JSON.parse(JSON.stringify(this.initialState)),this.status=t.STATUS_PLAYING,this.score=0,this.addRandomDigitToEmptyCell(2)}restart(){this.state=JSON.parse(JSON.stringify(this.initialState)),this.status=t.STATUS_IDLE,this.score=0}rotateStateBackwardBy90Deg(){let t=this.getState(),e=JSON.parse(JSON.stringify(t));for(let s=3;s>=0;s--)for(let r=0;r<4;r++)t[3-s][r]=e[r][s]}rotateStateForwardBy90Deg(){let t=this.getState(),e=JSON.parse(JSON.stringify(t));for(let s=3;s>=0;s--)for(let r=0;r<4;r++)t[r][3-s]=e[s][r]}reverseStateByRows(){let t=this.getState();for(let e=0;e<4;e++)t[e].reverse()}checkIsPlayerWin(){let t=this.getState(),e=!1;for(let s=0;s<4;s++)t[s].includes(2048)&&(e=!0);return e}checkIsPlayerLose(){let t=this.getState(),e=!1,s=!1,r=!1;for(let e=0;e<4;e++)if(t[e].includes(0)){s=!0;break}for(let e=0;e<4;e++)for(let s=0;s<3;s++)if(t[e][s]===t[e][s+1]){r=!0;break}for(let e=0;e<4;e++)for(let s=0;s<3;s++)if(t[s][e]===t[s+1][e]){r=!0;break}return s||r||(e=!0),e}addRandomDigitToEmptyCell(t){let e=this.getState(),s=0;for(;s<t;){let[t,r]=this.getRandomCoordinates(),a=this.getRandomDigit();!e[t][r]&&(e[t][r]=a,s++)}}getRandomCoordinates(){return[Math.floor(4*Math.random()),Math.floor(4*Math.random())]}getRandomDigit(){return Math.floor(100*Math.random())+1>90?4:2}}const e=new t,s=document.querySelector("table").tBodies[0],r=document.querySelector("button"),a=document.querySelector(".message-start"),i=document.querySelector(".message-lose"),o=document.querySelector(".message-win"),l=document.querySelector(".game-score");function n(){let t=e.getState();for(let e=0;e<4;e++)for(let r=0;r<4;r++){let a=t[e][r];if(!a){s.rows[e].cells[r].className="field-cell",s.rows[e].cells[r].innerText="";continue}s.rows[e].cells[r].className=`field-cell field-cell--${a}`,s.rows[e].cells[r].innerText=`${a}`}}r.addEventListener("click",()=>{if(r.classList.contains("restart")){e.restart(),r.classList.remove("restart"),r.classList.add("start"),r.textContent="Start",a.classList.remove("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),l.innerText="0",n();return}e.start(),a.classList.add("hidden"),n()}),document.addEventListener("keydown",s=>{let a=s.key;if("ArrowRight"===a||"ArrowLeft"===a||"ArrowUp"===a||"ArrowDown"===a){let s=e.getState(),c=e.getStatus();if(c===t.STATUS_IDLE||c===t.STATUS_LOSE||c===t.STATUS_WIN)return;r.classList.contains("start")&&(r.classList.remove("start"),r.classList.add("restart"),r.textContent="Restart");let S=JSON.stringify(s);switch(a){case"ArrowRight":e.moveRight();break;case"ArrowLeft":e.moveLeft();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}if(S===JSON.stringify(s))return;if(l.innerText=`${e.getScore()}`,e.addRandomDigitToEmptyCell(1),n(),e.checkIsPlayerWin()){e.status=t.STATUS_WIN,o.classList.remove("hidden");return}e.checkIsPlayerLose()&&(e.status=t.STATUS_LOSE,i.classList.remove("hidden"))}});
//# sourceMappingURL=index.9f7f956e.js.map
